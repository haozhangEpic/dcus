# å‰ç«¯ç›¸å…³çš„æ€§èƒ½ä¼˜åŒ–

> - åšä¼˜åŒ–åº”è¯¥æ˜¯ä¸€ä¸ª**æœ‰æŒ‡æ ‡ã€æœ‰æ¯”è¾ƒã€æœ‰æ•°æ®**çš„è¿‡ç¨‹
> - ä¸€ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆåº”è¯¥æ˜¯**è¯´æ¸…æ¥šæ ‡å‡†ï¼Œè®²æ¸…æ¥šç¼˜ç”±ï¼Œç®—æ¸…æ¥šç»“æœ**ï¼Œæœ€åç”¨**æ•°æ®ä¸æ”¶ç›Š**æ¥è¯´æ˜å·¥ä½œæˆæœ

# ä¸€ã€å»ºç«‹è¡¡é‡æ ‡å‡†

åœ¨ç¡®è®¤æŒ‡æ ‡ä¹‹åï¼Œè¿˜è¦æœ‰é‡åŒ–åŸºç¡€ï¼Œæœ‰æ•°æ®ç§¯ç´¯ã€‚

## ç†è®ºåŸºç¡€ - ä»¥ã€ç”¨æˆ·ä¸ºæ ¸å¿ƒã€çš„ RAIL æ€§èƒ½æ¨¡å‹

- **Responseï¼ˆå“åº”ï¼‰**ï¼šåº”è¯¥å°½å¯èƒ½å¿«é€Ÿçš„å“åº”ç»™å®¢æˆ·ï¼Œåº”è¯¥åœ¨ 100ms æˆ–è€… 100ms ä»¥å†…å“åº”ç”¨æˆ·è¾“å…¥ï¼›
- **Animationï¼ˆåŠ¨ç”»ï¼‰**ï¼šåœ¨å±•ç¤ºåŠ¨ç”»çš„æ—¶å€™ï¼Œæ¯ä¸€å¸§åº”è¯¥ä»¥ 16ms è¿›è¡Œæ¸²æŸ“ï¼Œè¿™æ ·å¯ä»¥ä¿æŒåŠ¨ç”»æ•ˆæœçš„ä¸€æ¬¡æ€§ï¼Œå¹¶ä¸”é¿å…å¡é¡¿ï¼›
- **Idleï¼ˆæµè§ˆå™¨ç©ºé—²æ—¶é—´ï¼‰**ï¼šå½“ä½¿ç”¨ JavaScript ä¸»çº¿ç¨‹æ—¶ï¼Œåº”è¯¥æŠŠä»»åŠ¡åˆ’åˆ†åˆ°æ‰§è¡Œæ—¶é—´å°äº 50ms çš„ç‰‡æ®µä¸­ï¼Œè¿™æ ·å¯ä»¥é‡Šæ”¾çº¿ç¨‹ä»¥è¿›è¡Œç”¨æˆ·äº¤äº’ï¼›
- **Loadï¼ˆåŠ è½½ï¼‰**ï¼šåº”è¯¥åœ¨ 1s çš„æ—¶é—´å†…åŠ è½½å®Œä½ çš„ç½‘ç«™ï¼Œå¹¶å¯ä»¥è¿›è¡Œç”¨æˆ·äº¤äº’ã€‚

## è¡¡é‡å·¥å…·

- Chrome DevTools

  - Performanceï¼šå¯æŸ¥çœ‹æ€§èƒ½æŒ‡æ ‡ï¼Œå¹¶æœ‰ç½‘é¡µå¿«ç…§ã€‚
  - Networkï¼šå¯ä»¥æŸ¥çœ‹å„ä¸ªèµ„æºçš„åŠ è½½æ—¶é—´ã€‚

- Lighthouse

  ï¼šéå¸¸æµè¡Œçš„ç¬¬ä¸‰æ–¹æ€§èƒ½è¯„æµ‹å·¥å…·ï¼Œæ”¯æŒç§»åŠ¨ç«¯å’Œ PCã€‚

  åœ¨æŠ¥å‘Šä¸­ä¼šå¯¹è¯¸å¦‚åˆæ¬¡å†…å®¹æ¸²æŸ“ã€å¯äº¤äº’æ—¶é—´ã€åŠ è½½ç­‰è¿›è¡Œå…·ä½“çš„æ•°å€¼é‡åŒ–æ‰“åˆ†ã€‚

  

  éœ€è¦æ³¨æ„ï¼š

  - Lighthouse å¹¶ä¸èƒ½çœŸå®çš„ååº”å‡ºæ¯ä¸ªç”¨æˆ·çš„è®¾å¤‡çš„å®é™…æ€§èƒ½æ•°æ®;
  - Lighthouse çš„åˆ†æ•°ååº”çš„æ˜¯ä¸šç•Œçš„æ ‡å‡†ï¼Œè€Œéé¡¹ç›®å®é™…éœ€æ±‚çš„æ ‡å‡†ã€‚
     é…ç½®ï¼šChrome â¡ï¸ å¼€å‘è€…å·¥å…· â¡ï¸ Lighthouse â¡ï¸ generate reportã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/49bb4ae880f0491381583de3e7619e4d~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=714&h=510&s=59384&e=png&b=ffffff)

- [**WebPageTest**](https://link.juejin.cn?target=https%3A%2F%2Fwebpagetest.org%2F)ï¼šåœ¨çº¿æµ‹é‡å’Œåˆ†æç½‘é¡µæ€§èƒ½ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/186f464b1ef941e397b09ab6ceb51a39~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=2736&h=1168&s=256601&e=png&b=1e2b48)

- [**PageSpeed Insights**](https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fspeed%2Fpagespeed%2Finsights%2F)ï¼šåœ¨çº¿è¯„ä¼°ç½‘ç«™æ€§èƒ½å’ŒåŠ è½½é€Ÿåº¦ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd5dca9a547b48dab69d88ec86f752ea~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=2550&h=934&s=143365&e=png&b=ffffff)

## æ€§èƒ½æŒ‡æ ‡

- **[Navigation Timing API](https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FPerformance_API%2FNavigation_timing%23interfaces)**ï¼šæµè§ˆå™¨æä¾›çš„ JS APIï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯æµ‹é‡ç½‘é¡µåŠ è½½çš„æ€§èƒ½ã€‚
- Lighthouse Performance
  - **FCP**ï¼ˆFirst Contentful Paintï¼‰ï¼šè®°å½•é¦–æ¬¡åŠ è½½å¹¶ç»˜åˆ¶å†…å®¹çš„æ—¶é—´ã€‚
  - **TTI**ï¼ˆTime to Interactï¼‰ï¼šé¡µé¢å¯äº¤äº’çš„æ—¶é—´ã€‚é€šå¸¸é€šè¿‡è®°å½•`window.performance.timing`ä¸­çš„ `loadEventStart`ä¸`fetchStart`çš„æ—¶é—´å·®æ¥å®Œæˆã€‚
  - **LCP**ï¼ˆLagest Contentful Paintï¼‰ï¼šæœ€å¤§å¯è§å…ƒç´ ç»˜åˆ¶ã€‚
  - **TBT**ï¼ˆTotal Blocking Timeï¼‰ï¼šæŒ‡ä»ä¸€ä¸ªè¯·æ±‚å‘é€åˆ°æ¥æ”¶åˆ°å“åº”æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œé€šå¸¸ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚
  - **CLS**ï¼ˆCumulative Layout Shiftï¼‰ï¼šè¡¡é‡åœ¨ç½‘é¡µçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…å‘ç”Ÿçš„æ‰€æœ‰æ„å¤–å¸ƒå±€åç§»çš„å¾—åˆ†æ€»å’Œã€‚å¾—åˆ†æ˜¯é›¶åˆ°ä»»æ„æ­£æ•°ï¼Œå…¶ä¸­ 0 è¡¨ç¤ºæ— åç§»ï¼Œä¸”æ•°å­—è¶Šå¤§ï¼Œç½‘é¡µçš„å¸ƒå±€åç§»è¶Šå¤§ã€‚ä¸ºäº†æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œç½‘ç«™åº”åŠªåŠ›ä½¿ CLS å¾—åˆ†ä¸è¶…è¿‡0.1ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/10abf1455bf84769aeb02f2bf7eaeca8~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1516&h=990&s=178790&e=png&b=ffffff)

# äºŒã€åˆ¶å®šä¼˜åŒ–æ–¹æ¡ˆ

æˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹å‡ æ–¹é¢è¿›è¡Œä¼˜åŒ–ã€‚

- DNS è§£æ
- TCP è¿æ¥ä¼˜åŒ–
- è¯·æ±‚ä¼˜åŒ–
- é¡µé¢æ¸²æŸ“ä¼˜åŒ–
- JS ä¼˜åŒ–
- CSS ä¼˜åŒ–
- React ä¼˜åŒ–
- å›¾ç‰‡ä¼˜åŒ–
- Webpack æ‰“åŒ…ä¼˜åŒ–

## DNS è§£æ

### 1. DNS é¢„è§£æ

é€šè¿‡ä½¿ç”¨`dns-prefetch`DNS é¢„è§£æï¼Œæå‰è·å– IP åœ°å€ã€‚

```html
html
å¤åˆ¶ä»£ç <link rel="dns-prefetch" href="xxx" />
```

åœ¨å·¥ç¨‹åŒ–ç¯å¢ƒä¸‹ï¼Œå†™ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œè¯»å–æ‰“åŒ…ç»“æœï¼Œæå–ä»£ç ä¸­çš„å¤–é“¾æ¥ï¼Œè¿›è¡Œ DNS é¢„è§£æã€‚

```js
jså¤åˆ¶ä»£ç const fs = require("fs");
const path = require("path");
const { parse } = require("node-html-parser");
const { glob } = require("glob");
const urlRegex = require("url-regex");
const { strict } = require("assert");

// è·å–å¤–éƒ¨é“¾æ¥çš„æ­£åˆ™è¡¨è¾¾å¼
const urlPattern = /(https?:\/\/[^/]*)/i;
const urls = new Set();
// éå† dist ç›®å½•ä¸­çš„æ‰€æœ‰ HTMLã€jsã€css æ–‡ä»¶
async function searchDomain() {
  const files = (await glob("build/**/*.{html,css,js}")) || [];
  for (const file of files) {
    const source = fs.readFileSync(file, "utf-8");
    const matches = source.match(urlRegex({ strict: true }));
    if (matches) {
      matches.forEach((url) => {
        const match = url.match(urlPattern);
        if (match && match[1]) {
          urls.add(match[1]);
        }
      });
    }
  }
}

// è¯»å–åŸŸåï¼Œç”Ÿæˆ link å…ƒç´ ï¼ŒåŠ å…¥åˆ°æ‰“åŒ…ç»“æœçš„ head å…ƒç´ ä¸­
async function insertLinks() {
  const files = (await glob("build/*.html")) || [];
  const links = [...urls]
    .map((url) => `<link rel="dns-prefetch" href="${url}">`)
    .join("\n");
  for (const file of files) {
    const html = fs.readFileSync(file, "utf-8");
    const root = parse(html);
    const head = root.querySelector("head");
    head.insertAdjacentHTML("afterbegin", links);
    fs.writeFileSync(file, root.toString());
  }
}

async function main() {
  await searchDomain();
  // åœ¨ head æ ‡ç­¾ä¸­æ·»åŠ é¢„å–é“¾æ¥
  await insertLinks();
}

main();
```

åœ¨webpackæ‰“åŒ…æ—¶æ‰§è¡Œä¸Šè¿°æ–‡ä»¶ï¼Œå°±å¯ä»¥å®ç°æ‰¹é‡ DNS é¢„è§£æã€‚

### 2. åŸŸåæ”¶æ•›

å‡å°‘é¡µé¢ä¸­åŸŸåçš„æ•°é‡ï¼Œä»è€Œå‡å°‘ DNS è§£ææ¬¡æ•°ã€‚

## TCP è¿æ¥ä¼˜åŒ–

### 1. ä½¿ç”¨`preconnect`æå‰å’Œç›®æ ‡æœåŠ¡å™¨è¿›è¡Œè¿æ¥

è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬ DNS æŸ¥è¯¢å¾—åˆ° IPã€TCP ä¸‰æ¬¡æ¡æ‰‹ã€HTTP æˆ– HTTPS è¿æ¥ã€‚

```html
html
å¤åˆ¶ä»£ç <link rel="preconnect" href="xxx" />
```

## è¯·æ±‚ä¼˜åŒ–

### 1. å¯ä»¥ä½¿ç”¨ http/2 åè®®

ä¾èµ– http/2 çš„å¤šè·¯å¤ç”¨ã€å¤´éƒ¨å‹ç¼©ã€äºŒè¿›åˆ¶ä¼ è¾“ã€æœåŠ¡ç«¯æ¨é€ç­‰ç‰¹æ€§ï¼Œä»è€ŒåŠ å¿«æ•´ä½“è¯·æ±‚çš„å“åº”é€Ÿåº¦ï¼ŒåŠ å¿«é¡µé¢çš„æ¸²æŸ“å±•ç¤ºã€‚

- **å¤šè·¯å¤ç”¨**
   å¤šè·¯å¤ç”¨å…è®¸åŒæ—¶é€šè¿‡å•ä¸€çš„ http/2 è¿æ¥å‘é€å¤šé‡è¯·æ±‚-å“åº”ä¿¡æ¯ã€‚è¿™ä¸ªåŠŸèƒ½ç›¸å½“äºæ˜¯é•¿è¿æ¥çš„å¢å¼ºï¼Œæ¯ä¸ª request è¯·æ±‚å¯ä»¥éšæœºçš„æ··æ‚åœ¨ä¸€èµ·ï¼Œæ¥æ”¶æ–¹å¯ä»¥æ ¹æ® request çš„ id å°† request å†å½’å±åˆ°å„è‡ªä¸åŒçš„æœåŠ¡ç«¯è¯·æ±‚é‡Œã€‚
   å¦å¤–ï¼Œå¤šè·¯å¤ç”¨ä¹Ÿæ”¯æŒäº†æµçš„ä¼˜å…ˆçº§ï¼Œå…è®¸å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡å™¨å“ªäº›å†…å®¹æ˜¯æ›´é«˜ä¼˜å…ˆçº§çš„èµ„æºï¼Œå¯ä»¥ä¼˜å…ˆä¼ è¾“ã€‚
   æ”¹å–„äº†ï¼šåœ¨ http1.1 ä¸­ï¼Œæµè§ˆå™¨å®¢æˆ·ç«¯åœ¨åŒä¸€æ—¶é—´ï¼Œé’ˆå¯¹åŒä¸€åŸŸåä¸‹çš„è¯·æ±‚æœ‰ä¸€å®šæ•°é‡é™åˆ¶ï¼ˆè¿æ¥æ•°é‡ï¼‰ï¼Œè¶…è¿‡é™åˆ¶ä¼šè¢«é˜»å¡ã€‚

- **å¤´éƒ¨å‹ç¼©**
   HTTP1.x çš„ header å¸¦æœ‰å¤§é‡ä¿¡æ¯ï¼Œè€Œä¸”æ¯æ¬¡éƒ½è¦é‡å¤å‘é€ã€‚
   HTTP2.0 ä½¿ç”¨ HPACK ç®—æ³•å¯¹ header çš„æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œå‡å°‘éœ€è¦ä¼ è¾“çš„ header å¤§å°ï¼Œé€šè®¯åŒæ–¹å„è‡ªç¼“å­˜ä¸€ä»½ header fields è¡¨ï¼Œå·®é‡æ›´æ–° HTTP å¤´ï¼Œæ—¢é¿å…äº†é‡å¤ header çš„ä¼ è¾“ï¼Œåˆå‡å°äº†éœ€è¦ä¼ è¾“çš„å¤§å°ã€‚

- **äºŒè¿›åˆ¶ä¼ è¾“**
   HTTP1.0 çš„è§£ææ˜¯åŸºäºæ–‡æœ¬çš„ï¼ŒHTTP 2.0 ä¼šå°†æ‰€æœ‰çš„ä¼ è¾“ä¿¡æ¯åˆ†å‰²ä¸ºæ›´å°çš„ä¿¡æ¯æˆ–è€…å¸§ï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡ŒäºŒè¿›åˆ¶ç¼–ç ï¼ŒåŸºäºäºŒè¿›åˆ¶å¯ä»¥è®©åè®®æœ‰æ›´å¤šçš„æ‰©å±•æ€§ï¼Œæ¯”å¦‚ä½¿ç”¨å¸§æ¥ä¼ è¾“æ•°æ®å’ŒæŒ‡ä»¤ã€‚
   HTTP2.0 åœ¨åº”ç”¨å±‚ï¼ˆHTTP2.0ï¼‰å’Œä¼ è¾“å±‚ï¼ˆTCP/UDPï¼‰ä¹‹é—´å¢åŠ ä¸€ä¸ªäºŒè¿›åˆ¶åˆ†å¸§å±‚ã€‚åœ¨ä¸æ”¹åŠ¨ HTTP1.x çš„è¯­ä¹‰ã€æ–¹æ³•ã€çŠ¶æ€ç ã€URI ä»¥åŠé¦–éƒ¨å­—æ®µçš„æƒ…å†µä¸‹ï¼Œè§£å†³äº† HTTP 1.1 çš„æ€§èƒ½é™åˆ¶ï¼Œæ”¹è¿›ä¼ è¾“æ€§èƒ½ï¼Œå®ç°ä½å»¶è¿Ÿå’Œé«˜ååé‡ã€‚
   åœ¨äºŒè¿›åˆ¶åˆ†å¸§å±‚ä¸­ï¼ŒHTTP2.0 ä¼šå°†æ‰€æœ‰ä¼ è¾“çš„ä¿¡æ¯åˆ†å‰²ä¸ºæ›´å°çš„æ¶ˆæ¯å’Œå¸§ï¼ˆframeï¼‰ï¼Œå¹¶å¯¹å®ƒä»¬é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼çš„ç¼–ç ï¼Œå…¶ä¸­ HTTP1.x çš„é¦–éƒ¨ä¿¡æ¯ä¼šè¢«å°è£…åˆ° HEADER frameï¼Œè€Œç›¸åº”çš„ Request Body åˆ™å°è£…åˆ° DATA frame é‡Œé¢ã€‚

  > **å¸§ï¼š** HTTP 2.0 æ•°æ®é€šä¿¡çš„æœ€å°å•ä½ä¿¡æ¯ï¼ˆæŒ‡ HTTP 2.0 ä¸­é€»è¾‘ä¸Šçš„ HTTP ä¿¡æ¯ï¼‰ã€‚ä¾‹å¦‚è¯·æ±‚å’Œå“åº”ç­‰ï¼Œæ¶ˆæ¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ç»„æˆã€‚
  >  **æµï¼š** å­˜åœ¨äºè¿æ¥ä¸­çš„ä¸€ä¸ªè™šæ‹Ÿé€šé“ã€‚æµå¯ä»¥æ‰¿è½½åŒå‘æ¶ˆæ¯ï¼Œæ¯ä¸ªæµéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•° IDã€‚

- **æœåŠ¡ç«¯æ¨é€**
   æœåŠ¡ç«¯æ¨é€æ˜¯ä¸€ç§åœ¨å®¢æˆ·ç«¯è¯·æ±‚ä¹‹å‰å‘é€æ•°æ®çš„æœºåˆ¶ã€‚
   æœåŠ¡ç«¯å¯ä»¥åœ¨å‘é€ HTML é¡µé¢æ—¶ä¸»åŠ¨æ¨é€å…¶ä»–èµ„æºï¼Œè€Œä¸ç”¨ç­‰åˆ°æµè§ˆå™¨è§£æåˆ°ç›¸åº”ä½ç½®ï¼Œå‘èµ·è¯·æ±‚å†å“åº”ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡ç«¯å¯ä»¥ä¸»åŠ¨æŠŠ JSã€CSS æ–‡ä»¶æ¨é€ç»™æœåŠ¡ç«¯ï¼Œè€Œä¸éœ€è¦å®¢æˆ·ç«¯è§£æ HTML æ—¶å†å‘é€è¿™äº›è¯·æ±‚ã€‚
   æœåŠ¡ç«¯æ¨é€çš„è¿™äº›èµ„æºè¢«ä¿å­˜åœ¨äº†å®¢æˆ·ç«¯çš„æŸå¤„åœ°æ–¹ï¼Œå®¢æˆ·ç«¯ç›´æ¥ä»æœ¬åœ°åŠ è½½è¿™äº›èµ„æºå°±å¯ä»¥äº†ï¼Œä¸ç”¨èµ°ç½‘ç»œï¼Œé€Ÿåº¦è‡ªç„¶å¿«å¾ˆå¤šã€‚

### 2. é™æ€èµ„æºä½¿ç”¨ CDN

CDNï¼ˆå†…å®¹åˆ†å‘ç½‘ç»œï¼ŒContent Delivery/Distribut Nectworkï¼‰ï¼Œæ˜¯å»ºç«‹å¹¶è¦†ç›–åœ¨æ‰¿è½½ç½‘ä¹‹ä¸Šï¼Œç”±åˆ†é…åœ¨ä¸åŒåŒºåŸŸçš„è¾¹ç¼˜èŠ‚ç‚¹æœåŠ¡å™¨ç¾¤ç»„æˆçš„åˆ†å¸ƒå¼ç½‘ç»œã€‚

**CDN åŠ é€Ÿçš„æœ¬è´¨æ˜¯ç¼“å­˜åŠ é€Ÿ**ã€‚å°†æœåŠ¡å™¨ä¸Šå­˜å‚¨çš„é™æ€å†…å®¹ç¼“å­˜åˆ° CDN èŠ‚ç‚¹ä¸Šï¼Œå½“è®¿é—®è¿™äº›é™æ€å†…å®¹æ—¶ï¼Œæ— éœ€è®¿é—®æœåŠ¡å™¨æºç«™ï¼Œå°±è¿‘è®¿é—® CDN èŠ‚ç‚¹å³å¯è·å–ç›¸åŒå†…å®¹ï¼Œä»è€Œè¾¾åˆ°åŠ é€Ÿçš„æ•ˆæœï¼ŒåŒæ—¶å‡è½»æœåŠ¡å™¨æºç«™çš„å‹åŠ›ã€‚
 **ç®€å•æ¥è¯´ï¼ŒCDNå°±æ˜¯æ ¹æ®ç”¨æˆ·ä½ç½®åˆ†é…æœ€è¿‘çš„èµ„æºã€‚**

**![é—®é¢˜.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d495dfe77c7f4131b52cc85ceb9e13f7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=208&h=200&s=3028&e=png&a=1&b=ff6666)  CDN å·¥ä½œåŸç†**
 åœ¨æ²¡æœ‰ CDN æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨åŸŸåè®¿é—®ä¸€ä¸ªç«™ç‚¹çš„è·¯å¾„ä¸ºï¼šç”¨æˆ·æäº¤åŸŸå -> æµè§ˆå™¨å¯¹åŸŸåè¿›è¡Œè§£æ -> DNS è§£æå¾—åˆ°ç›®çš„ä¸»æœºçš„ IP åœ°å€ -> æ ¹æ® IP åœ°å€å‘å‡ºè¯·æ±‚ -> å¾—åˆ°è¯·æ±‚æ•°æ®å¹¶å›å¤ã€‚
 ä½¿ç”¨ CDN åï¼ŒDNS è¿”å›çš„ä¸å†æ˜¯ä¸€ä¸ª IP åœ°å€ï¼Œè€Œæ˜¯ä¸€ä¸ª CNameï¼ˆCanonical Nameï¼‰åˆ«åè®°å½•ï¼ŒæŒ‡å‘ CDN çš„å…¨å±€è´Ÿè½½å‡è¡¡ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cabcab54830648fcb1fdb775e8f9059f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=966&h=818&s=78983&e=png&b=ffffff)

1. å½“ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸Šè¾“å…¥ URL æ—¶ï¼Œç»è¿‡æœ¬åœ° DNS ç³»ç»Ÿè§£æï¼ŒDNS ç³»ç»Ÿä¼šæœ€ç»ˆå°†åŸŸåçš„è§£ææƒäº¤ç»™ CNAME æŒ‡å‘çš„ CDN ä¸“ç”¨ DNS æœåŠ¡å™¨ï¼›
2. CDN ä¸“ç”¨ DNS æœåŠ¡å™¨å°† CDN å…¨å±€è´Ÿè½½å‡è¡¡è®¾å¤‡çš„ IP åœ°å€è¿”å›ç»™ç”¨æˆ·ï¼›
3. ç”¨æˆ·å‘ CDN å…¨å±€è´Ÿè½½å‡è¡¡è®¾å¤‡å‘èµ·å†…å®¹ URL è®¿é—®è¯·æ±‚ï¼›
4. CDN å…¨å±€è´Ÿè½½å‡è¡¡è®¾å¤‡æ ¹æ®ç”¨æˆ· IP åœ°å€ä»¥åŠç”¨æˆ·è¯·æ±‚çš„å†…å®¹ URLï¼Œé€‰æ‹©ä¸€å°ç”¨æˆ·æ‰€å±åŒºåŸŸçš„ CDN åŒºåŸŸè´Ÿè½½å‡è¡¡è®¾å¤‡ï¼Œå‘Šè¯‰ç”¨æˆ·å‘è¿™å°è®¾å¤‡å‘èµ·è¯·æ±‚ï¼›
5. CDN åŒºåŸŸè´Ÿè½½å‡è¡¡è®¾å¤‡ä¼šä¸ºç”¨æˆ·é€‰æ‹©ä¸€å°åˆé€‚çš„ç¼“å­˜æœåŠ¡å™¨æä¾›æœåŠ¡ï¼Œç„¶å CDN åŒºåŸŸè´Ÿè½½å‡è¡¡è®¾å¤‡ä¼šå‘å…¨å±€è´Ÿè½½å‡è¡¡è®¾å¤‡è¿”å›ä¸€å°ç¼“å­˜æœåŠ¡å™¨çš„ IP åœ°å€ï¼ˆé€‰æ‹©çš„ä¾æ®åŒ…æ‹¬ï¼šæ ¹æ®ç”¨æˆ· IP åœ°å€ï¼Œåˆ¤æ–­å“ªä¸€å°æœåŠ¡å™¨è·ç”¨æˆ·æœ€è¿‘ï¼›æ ¹æ®ç”¨æˆ·æ‰€è¯·æ±‚çš„ URL ä¸­æºå¸¦çš„å†…å®¹åç§°ï¼Œåˆ¤æ–­å“ªä¸€å°æœåŠ¡å™¨ä¸Šæœ‰ç”¨æˆ·æ‰€éœ€å†…å®¹ï¼›æŸ¥è¯¢å„ä¸ªæœåŠ¡å™¨å½“å‰çš„è´Ÿè½½æƒ…å†µï¼Œåˆ¤æ–­å“ªä¸€å°æœåŠ¡å™¨å°šæœ‰è´Ÿè½½èƒ½åŠ›ç­‰ç­‰ï¼‰ï¼›
6. å…¨å±€è´Ÿè½½å‡è¡¡è®¾å¤‡æŠŠç¼“å­˜æœåŠ¡å™¨çš„ IP åœ°å€è¿”å›ç»™ç”¨æˆ·ï¼›
7. ç”¨æˆ·å‘ç¼“å­˜æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œç¼“å­˜æœåŠ¡å™¨å“åº”ç”¨æˆ·è¯·æ±‚ï¼Œå°†ç”¨æˆ·æ‰€éœ€å†…å®¹è¿”å›ç»™ç”¨æˆ·ã€‚å¦‚æœè¿™å°ç¼“å­˜æœåŠ¡å™¨ä¸Šæ²¡æœ‰ç”¨æˆ·æƒ³è¦çš„å†…å®¹ï¼Œè€ŒåŒºåŸŸè´Ÿè½½å‡è¡¡è®¾å¤‡ä¾ç„¶å°†å®ƒåˆ†é…ç»™äº†ç”¨æˆ·ï¼Œé‚£ä¹ˆè¿™å°ç¼“å­˜æœåŠ¡å™¨å°±éœ€è¦å‘å®ƒçš„ä¸Šä¸€å±‚ç¼“å­˜æœåŠ¡å™¨è¯·æ±‚å†…å®¹ï¼Œç›´è‡³è¿½æº¯åˆ°ç½‘ç«™çš„æºæœåŠ¡å™¨å°†å†…å®¹æ‹‰å›åˆ°æœ¬åœ°ã€‚

**![é—®é¢˜.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d495dfe77c7f4131b52cc85ceb9e13f7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=208&h=200&s=3028&e=png&a=1&b=ff6666)  ä¸ºä»€ä¹ˆåŠ¨æ€å†…å®¹ä¸é€‚åˆæ”¾åœ¨ CDN ä¸Šå‘¢ï¼Ÿ**
 ç”±äºè®¿é—®åŠ¨æ€å†…å®¹æ—¶ï¼Œæ¯æ¬¡éƒ½éœ€è¦è®¿é—®æœåŠ¡å™¨ï¼Œç”±æœåŠ¡å™¨åŠ¨æ€ç”Ÿæˆå®æ—¶çš„æ•°æ®å¹¶è¿”å›ã€‚å› æ­¤ CDN çš„ç¼“å­˜åŠ é€Ÿä¸é€‚ç”¨äºåŠ é€ŸåŠ¨æ€å†…å®¹ï¼ŒCDN æ— æ³•ç¼“å­˜å®æ—¶å˜åŒ–çš„åŠ¨æ€å†…å®¹ã€‚å¯¹äºåŠ¨æ€å†…å®¹è¯·æ±‚ï¼ŒCDN èŠ‚ç‚¹åªèƒ½è½¬å‘å›æœåŠ¡å™¨æºç«™ï¼Œæ²¡æœ‰åŠ é€Ÿæ•ˆæœã€‚

### 3. ä¼˜åŒ– [http ç¼“å­˜ç­–ç•¥](https://juejin.cn/post/7344572677393694758#heading-2)

### 4. è¯·æ±‚æ¥å£ä¼˜åŒ–

- æ¥å£è¯·æ±‚åˆå¹¶

## é¡µé¢æ¸²æŸ“ä¼˜åŒ–

### 1. éª¨æ¶å±ã€Loading å›¾æ ‡

### 2. æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ã€[Next.js](https://link.juejin.cn?target=https%3A%2F%2Fwww.nextjs.cn%2F)

## JS ä¼˜åŒ–

### 1. é˜²æŠ–å’ŒèŠ‚æµ

- èŠ‚æµ

  è§„å®šåœ¨ä¸€ä¸ªå•ä½æ—¶é—´å†…åªèƒ½è§¦å‘ä¸€æ¬¡å‡½æ•°ã€‚å¦‚æœè¿™ä¸ªå•ä½æ—¶é—´å†…è§¦å‘å¤šæ¬¡å‡½æ•°ï¼Œåªæœ‰ä¸€æ¬¡ç”Ÿæ•ˆã€‚

  é€‚ç”¨åœºæ™¯ï¼š

   èŠ‚æµé€‚ç”¨äºéœ€è¦æ§åˆ¶å‡½æ•°æ‰§è¡Œé¢‘ç‡çš„åœºæ™¯ï¼Œæ¯”å¦‚æ»šåŠ¨ã€æŒ‰é’®ç‚¹å‡»ã€æäº¤è¡¨å•ç­‰ã€‚

  ```js
  jså¤åˆ¶ä»£ç // æ‰‹å†™ç®€åŒ–ç‰ˆå®ç°
  // 1. å®šæ—¶å™¨å®ç°ï¼ˆéç«‹å³æ‰§è¡Œç‰ˆï¼‰
  const throttle = (fn, delay = 500) => {
    let flag = false;
    return (...args) => {
      if(flag) return;
      flag = true;
      setTimeout(() => {
        fn.apply(this, args);
          flag = false;
      }, delay);
    }
  }
  
  // 2. æ—¶é—´æˆ³å®ç°ï¼ˆç«‹å³æ‰§è¡Œç‰ˆï¼‰
  const throttle = (fn, delay = 500) => {
    let preTime = 0;
    return (...args) => {
          const nowTime = Date.now();
          if(nowTime - preTime >= delay) {
              preTime = Date.now();
              fn.apply(this, args);
          }
      }
  }
  
  // 3. å®ç°å‚æ•°æ§åˆ¶æ˜¯ç«‹å³æ‰§è¡Œè¿˜æ˜¯éç«‹å³æ‰§è¡Œçš„èŠ‚æµ
  const throttle = (fn, delay = 500, immediate = false) => {
    let preTime = immediate ? 0 : Date.now();
    return (...args) => {
        const nowTime = Date.now();
        if(nowTime - preTime >= delay) {
            preTime = Date.now();
            fn.apply(this, args);
        }
    }
  }
  
  // 4. lodash.throttle (https://www.lodashjs.com/docs/lodash.throttle)
  const throttle = lodash.throttle(() => fn(), delay, options)
  ```

- é˜²æŠ–

  åœ¨äº‹ä»¶è¢«è§¦å‘ n ç§’åå†æ‰§è¡Œå›è°ƒï¼Œå¦‚æœåœ¨è¿™ n ç§’å†…åˆè¢«è§¦å‘ï¼Œåˆ™é‡æ–°è®¡æ—¶ã€‚

  é€‚ç”¨åœºæ™¯ï¼š

   é˜²æŠ–é€‚ç”¨äºéœ€è¦ç­‰å¾…ç”¨æˆ·åœæ­¢æŸä¸ªæ“ä½œåæ‰§è¡Œçš„åœºæ™¯ï¼Œå¦‚æœç´¢ã€è¾“å…¥æ¡†å˜åŒ–ã€è”æƒ³è¯ç­‰ã€‚

  ```js
  jså¤åˆ¶ä»£ç // æ‰‹å†™ç®€åŒ–ç‰ˆå®ç°
  // 1. å®šæ—¶å™¨å®ç°ï¼ˆéç«‹å³æ‰§è¡Œï¼‰
  const debounce = (fn, delay) => {
    let timeId = null;
    return (...args) => {
      if(timeId) {
        clearTimeout(timeId);
      }
      timeId = setTimeout(() => {
        fn.apply(this, args);
      }, delay);
    }
  };
  
  // 2. lodash.debounceï¼ˆhttps://www.lodashjs.com/docs/lodash.debounceï¼‰
  const debounce = lodash.debounce(() => fun(), delay, options);
  
  // 3. é˜²æŠ–å¦‚æœéœ€è¦ç«‹å³æ‰§è¡Œï¼Œåˆ™éœ€è¦ç¬¬ä¸‰ä¸ªå‚æ•°
  const debounce = function(func, delay, immediate) {
    let timeId;
    return function () {
      let context = this;
      let args = arguments;
      if (timeId) clearTimeout(timeId); // timeId ä¸ä¸ºnull
      if (immediate) {
        let callNow = !timeId; // ç¬¬ä¸€æ¬¡ä¼šç«‹å³æ‰§è¡Œï¼Œä»¥ååªæœ‰äº‹ä»¶æ‰§è¡Œåæ‰ä¼šå†æ¬¡è§¦å‘
        timeId = setTimeout(function () {
          timeId = null;
        }, delay)
        if (callNow) {
          func.apply(context, args);
        }
      } else {
        timeId = setTimeout(function () {
          func.apply(context, args);
        }, delay);
      }
    }
  }
  ```

### 2. [é¿å… script æ ‡ç­¾é˜»å¡é¡µé¢æ¸²æŸ“](https://juejin.cn/post/7344572677393694758#heading-13)

## CSS ä¼˜åŒ–

### 1. å‡å°‘[å›æµå’Œé‡ç»˜](https://juejin.cn/post/7344572677393694758#heading-16)

## React ä¼˜åŒ–

1. **å°½é‡ä½¿ç”¨`shouldComponent`ã€`React.PureComponent`ã€`React.memo`ï¼Œé¿å…ä¸å¿…è¦çš„ renderã€‚**

2. **ç±»ç»„ä»¶ä¸­é¿å…ä½¿ç”¨å†…è”å‡½æ•°ï¼Œé¿å…æ¯æ¬¡è°ƒç”¨ render å‡½æ•°æ—¶éƒ½è¦é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°å®ä¾‹ã€‚**

3. **ä½¿ç”¨`Fragement`æ ‡ç­¾å‡å°‘å±‚çº§ï¼Œé¿å…é¢å¤–æ ‡è®°ã€‚**

4. **å¾ªç¯ä½¿ç”¨`key`ï¼Œä½†æ³¨æ„`key`å€¼ä¸è¦è®¾ç½®ä¸º`index`ã€‚**

5. **Hook ç»„ä»¶ä½¿ç”¨`useMemo`ç¼“å­˜å€¼ï¼Œ`useCallback`ç¼“å­˜å‡½æ•°ã€‚**

6. ä½¿ç”¨`React.lazy`å’Œ`Suspense`ç»„ä»¶æ¥å®ç°å¤§ç»„ä»¶æŒ‰éœ€åŠ è½½/æ‡’åŠ è½½ã€‚

   ```jsx
   jsxå¤åˆ¶ä»£ç const MyComponent = React.lazy(() => import('./MyComponent'));
   
   export const johanAsyncComponent = props => (
     <React.Suspense fallback={<Spinner />}>
       <johanComponent {...props} />
     </React.Suspense>
   );
   ```

7. è·¯ç”±æ‡’åŠ è½½

   åœ¨ä½¿ç”¨å‰ç«¯è·¯ç”±æ—¶ï¼Œä½¿ç”¨æŒ‰éœ€åŠ è½½è·¯ç”±ç»„ä»¶ï¼Œä»¥å‡å°‘åˆå§‹åŠ è½½ä½“ç§¯ã€‚

   ```jsx
   jsx
   å¤åˆ¶ä»£ç const Home = () => import('./Home.vue');
   ```

## å›¾ç‰‡ä¼˜åŒ–

### 1. é€‰æ‹©åˆé€‚çš„å›¾ç‰‡æ ¼å¼

| ç±»å‹         | ä¼˜ç‚¹                                       | ç¼ºç‚¹                                                       | é€‚ç”¨åœºæ™¯                        |
| ------------ | ------------------------------------------ | ---------------------------------------------------------- | ------------------------------- |
| **JPEG/JPG** | è‰²å½©ä¸°å¯Œï¼›æ–‡ä»¶å°ï¼›æ— å…¼å®¹é—®é¢˜               | æœ‰æŸå‹ç¼©ï¼Œåå¤ä¿å­˜å›¾ç‰‡è´¨é‡ä¸‹é™æ˜æ˜¾ï¼›ä¸æ”¯æŒåŠ¨ç”»ï¼›ä¸æ”¯æŒé€æ˜ | è‰²å½©ä¸°å¯Œçš„å›¾ç‰‡/æ¸å˜å›¾åƒ         |
| **PNG**      | ç®€å•å›¾ç‰‡å°ºå¯¸å°ï¼›æ— æŸå‹ç¼©ï¼›æ”¯æŒé€æ˜         | ä¸æ”¯æŒåŠ¨ç”»ï¼›è‰²å½©ä¸°å¯Œçš„å›¾ç‰‡å°ºå¯¸å¤§                           | logoã€iconã€é€æ˜å›¾              |
| **GIF**      | æ–‡ä»¶å°ï¼›æ”¯æŒåŠ¨ç”»ã€é€æ˜ï¼›æ— å…¼å®¹æ€§é—®é¢˜       | åªæ”¯æŒ 256 ç§é¢œè‰²                                          | è‰²å½©ç®€å•çš„ logoã€iconã€åŠ¨å›¾     |
| **WebP**     | æ–‡ä»¶å°ï¼›æ”¯æŒæœ‰æŸå’Œæ— æŸå‹ç¼©ï¼›æ”¯æŒåŠ¨ç”»ã€é€æ˜ | æµè§ˆå™¨å…¼å®¹æ€§ä¸å¥½                                           | æ”¯æŒ webp æ ¼å¼çš„ app å’Œ webview |

### 2. å›¾ç‰‡å‹ç¼©

- webpack å‹ç¼©

  ```bash
  bashå¤åˆ¶ä»£ç # å®‰è£…ä¾èµ–
  npm install image-webpack-loader -D
  ```

  ```js
  jså¤åˆ¶ä»£ç // é…ç½® webpack
  module.exports = {
    ...
    module: {
      rules: [
        {
          test: /\.(png|jpe?g|gif|svg)(\?.*)?$/,
          use: [
            {
              loader: 'file-loader',
              options: {
                name: '[name].[hash:8].[ext]'
              },
            },
            {
              loader: 'image-webpack-loader',
              options: {
                // ç”¨äºæŒ‡å®šä½¿ç”¨ MozJPEG æ¥å‹ç¼© JPEG å›¾ç‰‡
                mozjpeg: {
                  progressive: true,  // è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨æ¸è¿›å¼çš„æ–¹å¼å‹ç¼©å›¾ç‰‡ï¼Œè¿™æ„å‘³ç€åœ¨å›¾ç‰‡åŠ è½½è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€æ­¥çœ‹åˆ°æ¸…æ™°åº¦é€’å¢çš„å›¾ç‰‡
                  quality: 75,  // è´¨é‡ï¼ˆ1-100ï¼‰ï¼Œè´¨é‡è¶Šé«˜ä½“ç§¯è¶Šå¤§ï¼Œè´¨é‡è¶Šä½ä½“ç§¯è¶Šå°ï¼›å¦‚æœä½¿ç”¨æ•°ç»„çš„è¯ï¼Œå°±å¯ä»¥è®¾ç½® 0 åˆ° 1 ä¹‹é—´çš„å°æ•°
                },
                // ç”¨äºæŒ‡å®šä½¿ç”¨ OptiPNG æ¥å‹ç¼© PNG å›¾ç‰‡
                optipng: {
                  enabled: true,  // è¡¨ç¤ºæ˜¯å¦å¯ç”¨å›¾ç‰‡å‹ç¼©çš„è®¾ç½®
                },
                // ç”¨äºæŒ‡å®šä½¿ç”¨ PNGQuant æ¥å‹ç¼© PNG å›¾ç‰‡
                pngquant: {
                  quality: [0.5, 0.65],
                  speed: 4,  // æŒ‡å®šå‹ç¼©çš„é€Ÿåº¦ï¼ˆ0-11ï¼‰ï¼Œå…¶ä¸­ 0 ä¸ºæœ€å¿«ä½†è´¨é‡æœ€å·®ï¼Œ11 ä¸ºæœ€æ…¢ä½†è´¨é‡æœ€å¥½
                },
                // ç”¨äºæŒ‡å®šä½¿ç”¨ Gifsicle æ¥å‹ç¼© GIF å›¾ç‰‡
                gifsicle: {
                  interlaced: false,
                },
                // ä¸æ”¯æŒWEBPå°±ä¸è¦å†™è¿™ä¸€é¡¹
                webp: { 
                  quality: 75
                },
              },
            },
          ],
        },
      ],
    },
  }
  ```

- å·¥å…·å‹ç¼©

  - [tinypng](https://link.juejin.cn?target=https%3A%2F%2Ftinypng.com%2F)ï¼šå…è´¹ã€æ‰¹é‡ã€é€Ÿåº¦å¿«ï¼›
  - [æ™ºå›¾å‹ç¼©](https://link.juejin.cn?target=https%3A%2F%2Fzhitu.isux.us%2F)ï¼šå…è´¹ã€æ‰¹é‡ã€å¥½ç”¨ï¼›
  - [squoosh](https://link.juejin.cn?target=https%3A%2F%2Fsquoosh.app%2F)ï¼šåœ¨çº¿å›¾ç‰‡å‹ç¼©å·¥å…·ï¼›
  - [compressor](https://link.juejin.cn?target=https%3A%2F%2Fcompressor.io%2F)ï¼šæ”¯æŒ JPGã€PNGã€SVGã€GIFã€‚

### 3. ä½¿ç”¨é›ªç¢§å›¾

é›ªç¢§å›¾ï¼ˆCSS Spritesï¼‰ï¼Œå›½å†…ä¹Ÿå« CSS ç²¾çµï¼Œæ˜¯ä¸€ç§ CSS å›¾åƒåˆæˆæŠ€æœ¯ï¼Œä¸»è¦ç”¨äºå°å›¾ç‰‡æ˜¾ç¤ºã€‚
 æŠŠè¯¸å¤šå°å›¾åˆæˆä¸€å¼ å¤§å›¾ï¼Œç”¨`background-position`å±æ€§æ¥ç¡®å®šå›¾ç‰‡ä½ç½®ï¼Œå¯ä»¥æœ‰æ•ˆçš„å‡å°‘è¯·æ±‚ä¸ªæ•°ã€‚
 é€‚ç”¨äºé¡µé¢å¤šä¸”å›¾ç‰‡ä¸°å¯Œçš„åœºæ™¯ã€‚
 åœ¨ webpack ä¸­[webpack-spritesmith](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fwebpack-spritesmith)æ’ä»¶æä¾›äº†è‡ªåŠ¨ç”Ÿæˆé›ªç¢§å›¾çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„æ ·å¼æ–‡ä»¶ã€‚

### 4. ä½¿ç”¨ iconfont

iconfontï¼ˆå­—ä½“å›¾æ ‡ï¼‰ï¼Œé€šè¿‡å­—ä½“çš„æ–¹å¼å±•ç¤ºå›¾æ ‡ï¼Œå¤šç”¨äºæ¸²æŸ“å›¾æ ‡ã€ç®€å•å›¾å½¢ã€ç‰¹æ®Šå­—ä½“ç­‰ã€‚
 [é˜¿é‡Œå­—ä½“å›¾æ ‡åº“](https://link.juejin.cn?target=https%3A%2F%2Fwww.iconfont.cn%2F)

### 5. å°å›¾ç‰‡è½¬ä¸º base64 ç¼–ç å­—ç¬¦ä¸²

```js
jså¤åˆ¶ä»£ç // webpack.prod.js
module.exports = {
  modules: {
    rules: [
      // å›¾ç‰‡ â€” è€ƒè™‘ base64 ç¼–ç çš„æƒ…å†µ
      {
        test: /\.(png|jpg|jpeg|gif)$/,
        use: {
          use: "url-loader",
          options: {
            limit: 5 * 1024,  // å°äº 5kb çš„å›¾ç‰‡ç”¨ base64 æ ¼å¼äº§å‡ºï¼›å¦åˆ™ï¼Œä¾ç„¶å»¶ç”¨ file-loader çš„å½¢å¼ï¼Œäº§å‡º url
            outputPath: "/img1/",  // æ‰“åŒ…åˆ° img ç›®å½•ä¸‹
          },
        },
      },
    ]
  }
}
```

### 6. å›¾ç‰‡æ‡’åŠ è½½

- `lazy='loading'`

  ```jsx
  jsx
  å¤åˆ¶ä»£ç <img src="img.png" lazy="loading" />
  ```

- ä½¿ç”¨ js ç›‘å¬é¡µé¢çš„æ»šåŠ¨

  ä½¿ç”¨ js å®ç°çš„ä¸»è¦åŸç†æ˜¯åˆ¤æ–­å½“å‰å›¾ç‰‡æ˜¯å¦åˆ°äº†å¯è§†åŒºåŸŸï¼š

  1. æ‹¿åˆ°æ‰€æœ‰çš„å›¾ç‰‡ DOMï¼›
  2. éå†æ¯ä¸ªå›¾ç‰‡ï¼Œåˆ¤æ–­å½“å‰å›¾ç‰‡æ˜¯å¦åˆ°è¾¾å¯è§†åŒºä¸èŒƒå›´ï¼›
  3. å¦‚æœåˆ°äº†ï¼Œå°±è®¾ç½®`src`å±æ€§ï¼ˆé¡µé¢åˆå§‹åŒ–æ—¶ï¼Œå›¾ç‰‡åœ°å€è®¾ç½®åœ¨`data-src`å±æ€§ä¸Šï¼‰ï¼›
  4. ç»‘å®š`window`çš„`scroll`äº‹ä»¶ï¼Œå¯¹å…¶è¿›è¡Œäº‹ä»¶ç›‘å¬ã€‚

  ```html
  htmlå¤åˆ¶ä»£ç <img
    data-src="çœŸå®å›¾ç‰‡åœ°å€" 
    src="åˆå§‹åŒ–å›¾ç‰‡åœ°å€"
  />
  <script>
    window.addEventListener('scroll', throttle(lazyLoad, 200));
    function lazyLoad() {
      let viewHeight = document.body.clientHeight; // è·å–å¯è§†åŒºé«˜åº¦
      let imgs = document.querySelectorAll('img[data-src]');
  
      imgs.forEach((item) => {
        if (!item.dataset.src) {
          return;
        }
        // ç”¨äºè·å¾—é¡µé¢ä¸­æŸä¸ªå…ƒç´ çš„å·¦ï¼Œä¸Šï¼Œå³å’Œä¸‹åˆ†åˆ«ç›¸å¯¹æµè§ˆå™¨è§†çª—çš„ä½ç½®
        let rect = item.getBoundingClientRect();
        if (rect.bottom >= 0 && rect.top < viewHeight) {
          item.src = item.dataset.src;
          item.removeAttribute('data-src');
        }
      });
    }
  </script>
  ```

- ä½¿ç”¨äº¤å‰è§‚å¯Ÿå™¨[IntersectionObserver](https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FIntersectionObserver)

  ```
  IntersectionObserver
  ```

  æ˜¯æµè§ˆå™¨åŸç”Ÿæä¾›çš„æ„é€ å‡½æ•°ï¼Œå¯ä»¥è‡ªåŠ¨â€œè§‚å¯Ÿâ€å…ƒç´ æ˜¯å¦å¯è§ã€‚

  ```
  IntersectionObserver
  ```

  æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š

  - `callback`ï¼šå¯è§æ€§å˜åŒ–æ—¶çš„å›è°ƒå‡½æ•°ï¼›
  - `option`ï¼šé…ç½®é€‰é¡¹ï¼Œå¯é€‰ã€‚

  ç›®æ ‡å…ƒç´ çš„å¯è§æ€§å˜åŒ–æ—¶ï¼Œä¼šè°ƒç”¨è§‚å¯Ÿå™¨çš„

  ```
  callback
  ```

  å›è°ƒå‡½æ•°ã€‚

  ```
  callback
  ```

  ä¸€èˆ¬ä¼šè§¦å‘ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯ç›®æ ‡å…ƒç´ åˆšåˆšè¿›å…¥è§†å£ï¼ˆå¼€å§‹å¯è§ï¼‰ï¼Œä¸€æ¬¡æ˜¯å®Œå…¨ç¦»å¼€è§†å£ï¼ˆå¼€å§‹ä¸å¯è§ï¼‰ã€‚

  ```js
  jså¤åˆ¶ä»£ç const imgs = document.querySelectorAll('img[data-src]')
  const config = {
    rootMargin: '0px',
    threshold: 0,
  };
  let observer = new IntersectionObserver((entries, self) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        let img = entry.target;
        let src = img.dataset.src;
        if (src) {
          img.src = src;
          img.removeAttribute('data-src');
        }
        // è§£é™¤è§‚å¯Ÿ
        self.unobserve(entry.target);
      }
    })
  }, config);
  
  imgs.forEach((image) => {
    // å¼€å§‹è§‚å¯Ÿ
    observer.observe(image);
  });
  ```

## Webpack æ‰“åŒ…ä¼˜åŒ–

### æé«˜æ‰“åŒ…é€Ÿåº¦

#### 1. ä¼˜åŒ– babel loader

- ä¼˜åŒ– loader çš„æ–‡ä»¶æœç´¢èŒƒå›´

  ```js
  jså¤åˆ¶ä»£ç module.exports = {
    module: {
      rules: [
        {
          test: /\.js$/,  // js æ–‡ä»¶æ‰ä½¿ç”¨ babel
          loader: ['babel-loader'],
          include: [resolve('src')],  // åªåœ¨ src æ–‡ä»¶ä¸‹æŸ¥æ‰¾
          exclude: /node_modules/  // ä¸ä¼šå»æŸ¥æ‰¾çš„æ–‡ä»¶
          }
      ]
    }
  }
  ```

- å°† babel ç¼–è¯‘è¿‡çš„æ–‡ä»¶ç¼“å­˜èµ·æ¥

  ```js
  jså¤åˆ¶ä»£ç module.exports = {
    module: {
      rules: [
        {
          test: /\.js$/,  // js æ–‡ä»¶æ‰ä½¿ç”¨ babel
          use: {
            loader: 'babel-loader',
            options: {
              cacheDirectory: true
            }
          },
        }
      ]
    }
  }
  ```

#### 2. IgnorePluginï¼šé¿å…å¼•å…¥æ— ç”¨æ¨¡å—

æ¯”å¦‚ï¼Œä½¿ç”¨ `moment`åº“ï¼š`import moment from 'moment'`ï¼Œé»˜è®¤ä¼šå¼•å…¥æ‰€æœ‰è¯­è¨€ js ä»£ç ï¼Œä»£ç è¿‡å¤§ï¼Œé‚£ä¹ˆå¦‚ä½•åªå¼•å…¥ä¸­æ–‡ï¼Ÿ

```js
jså¤åˆ¶ä»£ç // index.js
import 'moment/locale/zh-cn';

// webpack.prod.js
module.exports = {
  plugin: [
    new webpack.IgnorePlugin({  // å¿½ç•¥ moment ä¸‹çš„ /locale ç›®å½•
      resourceRegExp: /^\.\/locale$/,
      contextRegExp: /moment$/,
    }),
  ]
}
```

#### 3. noParseï¼šé¿å…é‡å¤æ‰“åŒ…

```js
jså¤åˆ¶ä»£ç module.exports = {
  module: {
    noParse: [/react\/.min\.js$/]
  }
}
```

**![é—®é¢˜.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d495dfe77c7f4131b52cc85ceb9e13f7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=208&h=200&s=3028&e=png&a=1&b=ff6666)  IgnorePlugin ğŸ†š noParseï¼š**

- IgnorePlugin ç›´æ¥ä¸å¼•å…¥ï¼Œä»£ç ä¸­æ²¡æœ‰
- noParse å¼•å…¥ï¼Œä½†ä¸æ‰“åŒ…

#### 4. HappyPackï¼šå¤šè¿›ç¨‹æ‰“åŒ…

JS æ˜¯å•çº¿ç¨‹çš„ï¼Œå¼€å¯å¤šè¿›ç¨‹æ‰“åŒ…ã€‚
 æé«˜æ„å»ºé€Ÿåº¦ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤šæ ¸ CPUã€‚
 ![016_æ³¨æ„-90.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/72c74cdcf9fc42b1b8f16dec732332d7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=300&h=300&s=7430&e=png&a=1&b=fcc0b9) happypack å·²ç»ä¸ç»´æŠ¤äº†ï¼Œå¯ä»¥ä½¿ç”¨ [thread-loader ](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fthread-loader)ä»£æ›¿

```js
jså¤åˆ¶ä»£ç // webpack.prod.js
const HappyPack = require('happypack');
module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        use: ["happyPack/loader?id=babel"],  // æŠŠå¯¹ .js æ–‡ä»¶çš„å¤„ç†è½¬äº¤ç»™ id ä¸º babel çš„ HappyPack å®ä¾‹
        include: srcPath,
      },
    ]
  },
  plugins: [
    // happyPack å¼€å¯å¤šè¿›ç¨‹æ‰“åŒ…
    new HappyPack({
      id: "babel",  // ç”¨å”¯ä¸€çš„æ ‡è¯†ç¬¦ id æ¥ä»£è¡¨å½“å‰çš„ HappyPack æ˜¯ç”¨æ¥å¤„ç†ä¸€ç±»ç‰¹å®šçš„æ–‡ä»¶
      loaders: ["babel-loader?cacheDirectory"],   // å¦‚ä½•å¤„ç† .js æ–‡ä»¶ï¼Œç”¨æ³•å’Œ Loader é…ç½®ä¸­ä¸€æ ·
    }),
  ]
}
```

#### 5. ParallelUglifyPluginï¼šå¤šè¿›ç¨‹å‹ç¼© JS

webpack å†…ç½® Uglify å·¥å…·å‹ç¼© jsã€‚
 JS æ˜¯å•çº¿ç¨‹çš„ï¼Œå¼€å¯å¤šè¿›ç¨‹å‹ç¼©æ›´å¿«ã€‚
 å’Œ happyPack åŒç†ã€‚

**å…³äºå¼€å¯å¤šè¿›ç¨‹æ‰“åŒ…ï¼š**

- é¡¹ç›®è¾ƒå¤§ï¼Œæ‰“åŒ…è¾ƒæ…¢ï¼Œå¼€å¯å¤šè¿›ç¨‹èƒ½æé«˜é€Ÿåº¦
- é¡¹ç›®è¾ƒå°ï¼Œæ‰“åŒ…å¾ˆå¿«ï¼Œå¼€å¯å¤šè¿›ç¨‹ä¼šé™ä½é€Ÿåº¦ï¼ˆè¿›ç¨‹å¼€é”€ï¼‰

```js
jså¤åˆ¶ä»£ç // webpack.prod.js
module.exports = {
  plugins: [
    // ä½¿ç”¨ ParallelUglifyPlugin å¹¶è¡Œå‹ç¼©è¾“å‡ºçš„ js ä»£ç 
    new ParallelUglifyPlugin({
      // ä¼ é€’ç»™ UglifyJS çš„å‚æ•°
      // è¿˜æ˜¯ä½¿ç”¨ UglifyJS å‹ç¼©ï¼Œåªä¸è¿‡å¸®åŠ©å¼€å¯äº†å¤šè¿›ç¨‹
      uglifyJS: {
        output: {
          beautify: false, // æœ€ç´§å‡‘çš„è¾“å‡º
          comments: false, // åˆ é™¤æ‰€æœ‰çš„æ³¨é‡Š
        },
        compress: {
          drop_console: true,  // åˆ é™¤æ‰€æœ‰çš„ console è¯­å¥ï¼Œå¯ä»¥å…¼å®¹ IE æµè§ˆå™¨
          collapse_vars: true,  // å†…åµŒå®šä¹‰äº†ä½†æ˜¯åªç”¨è¿‡ä¸€æ¬¡çš„å˜é‡
          reduce_vars: true,  // æå–å‡ºå‡ºç°å¤šæ¬¡ï¼Œä½†æ˜¯æ²¡æœ‰è¢«å®šä¹‰æˆå˜é‡å»å¼•ç”¨çš„é™æ€å€¼
        },
      },
    }),
  ]
}
/**
  * var a = 10;
  * var b = 20;
  * var c = a + b;
  * ä¼šè¢«ç¼–è¯‘æˆ
  * var c = 30;
  */
```

#### 6. ä½¿ç”¨ CDN åŠ é€Ÿ

1. é…ç½® CDN çš„å…¬å…±è·¯å¾„

   ```js
   jså¤åˆ¶ä»£ç module.exports = {
     output: {
       filename: "[name].[contenthash:8].js", // name å³å¤šå…¥å£æ—¶ï¼Œentry çš„ key
       path: distPath,
       publicPath: "https://cdn.abc.com", // ä¿®æ”¹æ‰€æœ‰é™æ€æ–‡ä»¶ url çš„å‰ç¼€ï¼ˆå¦‚ cdn åŸŸåï¼‰
     },
     module: {
       rules: [
         {
           test: /\.(png|jpg|jpeg|gif)$/,
           use: {
             loader: "url-loader",
             options: {
               // å°äº 5kb çš„å›¾ç‰‡ç”¨ base64 æ ¼å¼äº§å‡º
               // å¦åˆ™ï¼Œä¾ç„¶å»¶ç”¨ file-loader çš„å½¢å¼ï¼Œäº§å‡º url
               limit: 5 * 1024,
               outputPath: "/img1/",  // æ‰“åŒ…åˆ° img ç›®å½•ä¸‹
               publicPath: "http://cdn.abc.com",  // è®¾ç½®å›¾ç‰‡çš„ cdn åœ°å€ï¼ˆä¹Ÿå¯ä»¥ç»Ÿä¸€åœ¨å¤–é¢çš„ ï¼‰
             },
           },
         }
       ]
     }
   }
   ```

2. å°†æ‰“åŒ…åçš„ç»“æœï¼ˆdist ç›®å½•ï¼‰ä¸Šä¼ åˆ° CDN æœåŠ¡å™¨ä¸Šã€‚

### ç¼©å°æ‰“åŒ…ä½“ç§¯

#### 1. æŒ‰éœ€åŠ è½½

ä½¿ç”¨ Webpack ç­‰æ„å»ºå·¥å…·å¯ä»¥é€šè¿‡ä»£ç åˆ†å‰²å’ŒåŠ¨æ€å¯¼å…¥æ¥å®ç°æŒ‰éœ€åŠ è½½ã€‚é€šè¿‡`import()`è¯­æ³•ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½æ¨¡å—ã€‚

```js
jså¤åˆ¶ä»£ç const module = import('./module.js');
module.then((module) => {
    // ä½¿ç”¨åŠ è½½çš„æ¨¡å—
});
```

#### 2. æå–å…¬å…±ä»£ç 

```js
jså¤åˆ¶ä»£ç // webpack.prod.js
module.exports = {
  plugins: [
    // å¤šå…¥å£ â€”â€” ç”Ÿæˆ index.html
    new HtmlWebpackPlugin({
      template: path.join(srcPath, 'index.html'),
      filename: 'index.html',
      // chunks è¡¨ç¤ºè¯¥é¡µé¢éœ€è¦å¼•ç”¨å“ªäº› chunkï¼ˆå³ä¸Šé¢çš„ index å’Œ otherï¼‰
      chunks: ['index', 'vendor', 'common'] // è€ƒè™‘ä»£ç åˆ†å‰²
    }),
  ],
  optimization: {
    // åˆ†å‰²ä»£ç å—
    splitChunks: {
      /**
       * initial: å…¥å£ chunksï¼Œå¯¹äºå¼‚æ­¥å¯¼å…¥çš„æ–‡ä»¶ä¸å¤„ç†
       * async: å¼‚æ­¥ chunkï¼Œåªå¯¹å¼‚æ­¥å¯¼å…¥çš„æ–‡ä»¶å¤„ç†
       * all: å…¨éƒ¨ chunk
       */
      chunks: 'all',

      // ç¼“å­˜åˆ†ç»„
      cacheGroups: {
        // ç¬¬ä¸‰æ–¹æ¨¡å—
        vendor: {
          name: 'vendor', // chunk åç§°
          priority: 1, // æƒé™æ›´é«˜ï¼Œä¼˜å…ˆæŠ½ç¦»ï¼Œé‡è¦ï¼ï¼
          test: /node_modules/,
          minSize: 0, // å¤§å°é™åˆ¶
          minChunks: 1, // æœ€å°‘å¤ç”¨å‡ æ¬¡
        },

        // å…¬å…±çš„æ¨¡å—
        common: {
          name: 'common', // chunk åç§°
          priority: 0, // ä¼˜å…ˆçº§
          minSize: 0, // å…¬å…±æ¨¡å—çš„å¤§å°é™åˆ¶
          minChunks: 2 // å…¬å…±æ¨¡å—æœ€å°‘å¤ç”¨è¿‡å‡ æ¬¡
        }
      }
    }
  }
}
```

#### 3. **bundle åŠ  hash**

hash é€šå¸¸è¢«ä½œä¸ºå‰ç«¯é™æ€èµ„æºå®ç°å¢é‡æ›´æ–°çš„æ–¹æ¡ˆï¼Œé€šè¿‡åœ¨æ–‡ä»¶åä¸Šå¸¦ä¸Šä¸€ä¸² hash å­—ç¬¦ä¸²ï¼Œå‘Šè¯‰æµè§ˆå™¨è¯¥æ–‡ä»¶æ˜¯å¦å‘ç”Ÿæ›´æ–°ï¼Œä»è€Œå†³å®šæ˜¯å¦è¦ä½¿ç”¨ç¼“å­˜æœºåˆ¶ã€‚
 Webpack æ‰“åŒ…æ—¶çš„ hash æœ‰ä¸‰ç§ï¼šfullhashï¼ˆWebpack4.x ä¹‹å‰çš„å« hashï¼ŒWebpack5.x å« fullhash æˆ– hash éƒ½å¯ï¼‰ã€chunkhash å’Œ contenthashã€‚

åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å¯¹ output ä¸­æ‰“åŒ…çš„æ–‡ä»¶åä¸€èˆ¬é‡‡ç”¨ chunkhashï¼Œå¯¹äº css ç­‰æ ·å¼æ–‡ä»¶ï¼Œé‡‡ç”¨ contenthashï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—æ¯ä¸ªæ¨¡å—æœ€å°èŒƒå›´çš„æ”¹å˜ hash å€¼ã€‚
 ä¸€æ–¹é¢å¯ä»¥æœ€å¤§ç¨‹åº¦çš„åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜æœºåˆ¶ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼›
 å¦ä¸€æ–¹é¢ï¼Œåˆç†åˆ©ç”¨ hash ä¹Ÿå‡å°‘äº† webpack å†æ¬¡æ‰“åŒ…æ‰€è¦å¤„ç†çš„æ–‡ä»¶æ•°é‡ï¼Œæå‡äº†æ‰“åŒ…é€Ÿåº¦ã€‚

- **fullhash**
   fullhash æ˜¯å…¨é‡çš„ hashï¼Œæ˜¯æ•´ä¸ªé¡¹ç›®çº§åˆ«çš„ï¼Œåªè¦é¡¹ç›®ä¸­æœ‰ä»»ä½•çš„ä¸€ä¸ªæ–‡ä»¶å‘ç”Ÿå˜åŠ¨ï¼Œæ‰“åŒ…åæ‰€æœ‰æ–‡ä»¶çš„ hash å€¼éƒ½ä¼šæ”¹å˜ã€‚

  ```js
  jså¤åˆ¶ä»£ç // webpack.config.js
  module.exports = {
     output: {
        path: path.resolve(__dirname, "./dist"),
        filename: "[name].[hash].js",
        clean: true,
      }
  }
  ```

  æ‰§è¡Œ`npx webpack`å‘½ä»¤è¿›è¡Œé¡¹ç›®æ‰“åŒ…ã€‚

  | æ–‡ä»¶æ”¹åŠ¨å‰æ‰“åŒ…                                               | æ–‡ä»¶æ”¹åŠ¨åæ‰“åŒ…                                               |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | ![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ea5e2361638c443e86f25e2e5daa4e90~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=492&h=314&s=79416&e=png&b=262626) | ![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3c6e4ebc318c4a4b8de14fe8005c8e41~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=484&h=316&s=74740&e=png&b=262626) |

- **chunkhash**
   chunkhash æ ¹æ®ä¸åŒçš„å…¥å£æ–‡ä»¶ï¼ˆentryï¼‰è¿›è¡Œä¾èµ–æ–‡ä»¶è§£æã€æ„å»ºå¯¹åº”çš„ chunkï¼Œç”Ÿæˆå¯¹åº”çš„ hash å€¼ã€‚å½“æŸä¸ªæ–‡ä»¶å†…å®¹å‘ç”Ÿå˜åŠ¨æ—¶ï¼Œå†æ¬¡æ‰§è¡Œæ‰“åŒ…ï¼Œåªæœ‰è¯¥æ–‡ä»¶ä»¥åŠä¾èµ–è¯¥æ–‡ä»¶çš„æ–‡ä»¶çš„æ‰“åŒ…ç»“æœ hash å€¼ä¼šå‘ç”Ÿæ”¹å˜ã€‚

  ```js
  jså¤åˆ¶ä»£ç // webpack.config.js
  module.exports = {
     output: {
        path: path.resolve(__dirname, "./dist"),
        filename: "[name].[chunkhash].js",
        clean: true,
      }
  }
  ```

  | æ–‡ä»¶æ”¹åŠ¨å‰æ‰“åŒ…                                               | æ–‡ä»¶æ”¹åŠ¨åæ‰“åŒ…                                               |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | ![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/94d9d05ff26f4250ba1fdaa0150162a8~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=496&h=322&s=83525&e=png&b=262626) | ![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2dac82a0e1af43ac9bad935489a00500~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=500&h=318&s=79706&e=png&b=262626) |

  å› ä¸ºæ”¹åŠ¨äº†`add.js`æ–‡ä»¶ï¼Œæ‰€ä»¥ä¾èµ–äº†è¿™ä¸ªæ–‡ä»¶çš„`index.js`æ–‡ä»¶çš„ hash å€¼ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ï¼Œä½†æ˜¯é™¤æ­¤ä¹‹å¤–`index.css`æ–‡ä»¶çš„ hash å€¼ä¹Ÿå‘ç”Ÿäº†æ”¹å˜ï¼Œè¿™æ˜¯å› ä¸ºåœ¨`index.js`ä¸­å¼•ç”¨äº†`index.css`ï¼Œæ‰“åŒ…åå®ƒä»¬å±äºä¸€ä¸ªæ¨¡å—ã€‚

- **contenthash**
   contenthash æ˜¯åªæœ‰å½“æ–‡ä»¶è‡ªå·±çš„å†…å®¹å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå…¶æ‰“åŒ…çš„ hash å€¼æ‰ä¼šå‘ç”Ÿå˜åŠ¨ã€‚

  ```js
  jså¤åˆ¶ä»£ç // webpack.config.js
  module.exports = {
     output: {
        path: path.resolve(__dirname, "./dist"),
        filename: "[name].[conenthash].js",
        clean: true,
      }
  }
  ```

  | æ–‡ä»¶æ”¹åŠ¨å‰æ‰“åŒ…                                               | æ–‡ä»¶æ”¹åŠ¨åæ‰“åŒ…                                               |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | ![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eaccedbbaaea40e3989ad502641dadd2~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=508&h=320&s=81199&e=png&b=262626) | ![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/82c16404979b43ba91aae29a7689590a~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=508&h=318&s=79832&e=png&b=262626) |

  åªæœ‰ add.js å’Œ index.js æ–‡ä»¶çš„ hash å€¼å‘ç”Ÿäº†æ”¹å˜ã€‚

#### 4. ä½¿ç”¨`production`æ¨¡å¼

```js
jså¤åˆ¶ä»£ç module.exports = {
  mode: 'production'
}
```

- è‡ªåŠ¨å¼€å¯å‹ç¼©
- Vueã€React ç­‰ä¼šè‡ªåŠ¨åˆ æ‰æµ‹è¯•ä»£ç ï¼ˆå¦‚å¼€å‘ç¯å¢ƒçš„ waringï¼‰
- å¯ç”¨ Tree Shaking

**Tree Shaking**

Tree Shaking å¯ä»¥ç”¨æ¥åˆ é™¤é¡¹ç›®ä¸­æœªè¢«å¼•ç”¨çš„ä»£ç ã€‚

- Tree Shaking çš„è¿‡ç¨‹ï¼š

  Tree shaking çš„è¿‡ç¨‹ä¸»è¦æ¶‰åŠé™æ€åˆ†æã€æ ‡è®°ã€å’Œå‰”é™¤æœªä½¿ç”¨çš„ä»£ç ï¼Œ

  1. **é™æ€åˆ†æï¼š** Tree shaking ä¾èµ–äºæ¨¡å—ç³»ç»Ÿçš„é™æ€æ€§è´¨ï¼Œå› æ­¤å®ƒå¯ä»¥åœ¨ç¼–è¯‘æ—¶è¿›è¡Œé™æ€åˆ†æã€‚è¿™è¡¨ç¤ºåœ¨ä»£ç ä¸­é€šè¿‡ ES6 æ¨¡å—è¯­æ³•ï¼ˆimport/exportï¼‰æ˜ç¡®å£°æ˜äº†æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚

  2. **æ ‡è®°æœªä½¿ç”¨çš„ä»£ç ï¼š** Tree shaking é€šè¿‡æ ‡è®°ï¼ˆæ ‡è®°ä¸ºâ€œæ— ç”¨â€æˆ–â€œæœªä½¿ç”¨â€ï¼‰æœªè¢«å¼•ç”¨çš„æ¨¡å—ã€å˜é‡ã€å‡½æ•°ç­‰ï¼Œä»¥ä¾¿åç»­çš„æ­¥éª¤èƒ½å¤Ÿè¯†åˆ«å¹¶ç§»é™¤è¿™äº›æ— ç”¨çš„éƒ¨åˆ†ã€‚è¿™ä¸€æ­¥é€šå¸¸æ˜¯é€šè¿‡é™æ€åˆ†æå·¥å…·è¿›è¡Œçš„ã€‚

  3. **ä¾èµ–å…³ç³»åˆ†æï¼š** Tree shaking åˆ†ææ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä»¥ç¡®å®šå“ªäº›æ¨¡å—æ˜¯è¢«å¼•ç”¨çš„ï¼Œå“ªäº›æ¨¡å—æ˜¯æ²¡æœ‰è¢«å¼•ç”¨çš„ã€‚

  4. å‰”é™¤æœªä½¿ç”¨çš„ä»£ç ï¼š

      æ ¹æ®ä¹‹å‰çš„æ ‡è®°å’Œåˆ†æï¼Œtree shaking å°†ç§»é™¤æœªè¢«å¼•ç”¨çš„ä»£ç ã€‚è¿™ä¸ªæ­¥éª¤é€šå¸¸ç”±æ„å»ºå·¥å…·ï¼ˆå¦‚ Webpackï¼‰çš„ä¼˜åŒ–é˜¶æ®µå®Œæˆï¼Œé€šè¿‡é…ç½®å¯ç”¨å‹ç¼©å·¥å…·ï¼ˆå¦‚ UglifyJSPlugin æˆ– TerserPluginï¼‰æ¥å®ç°ã€‚

     - åœ¨ JavaScript ä¸­ï¼Œè¿™å¯èƒ½æ¶‰åŠåˆ°åˆ é™¤æœªè¢«å¼•ç”¨çš„å‡½æ•°ã€ç±»ã€å˜é‡ç­‰ã€‚
     - åœ¨æ ·å¼è¡¨ä¸­ï¼Œæœªä½¿ç”¨çš„æ ·å¼è§„åˆ™å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚

  5. **è¾“å‡ºä¼˜åŒ–åçš„ä»£ç ï¼š** æœ€ç»ˆï¼Œtree shaking ç”Ÿæˆä¸€ä¸ªä¼˜åŒ–åçš„ä»£ç åŒ…ï¼Œå…¶ä¸­åªåŒ…å«å®é™…è¢«åº”ç”¨ç¨‹åºä½¿ç”¨çš„ä»£ç ã€‚è¿™æœ‰åŠ©äºå‡å°åº”ç”¨ç¨‹åºçš„æ–‡ä»¶å¤§å°ï¼Œæé«˜åŠ è½½æ€§èƒ½ã€‚

- 

  æ³¨æ„äº‹é¡¹ï¼š

  - Tree shaking åªèƒ½å‰”é™¤é€šè¿‡ ES6 æ¨¡å—å¯¼å…¥çš„æœªä½¿ç”¨ä»£ç ã€‚CommonJS ç­‰å…¶ä»–æ¨¡å—ç³»ç»Ÿçš„å¯¼å…¥æ–¹å¼ä¸ä¼šè§¦å‘ tree shakingã€‚
  - æŸäº›æƒ…å†µä¸‹ï¼Œä¾‹å¦‚åŠ¨æ€å¯¼å…¥ï¼ˆ`import()`ï¼‰å’Œä½¿ç”¨ `require.context` çš„ä»£ç ï¼Œå¯èƒ½ä¼šå½±å“ tree shaking çš„æ•ˆæœï¼Œéœ€è¦é¢å¤–çš„æ³¨æ„ã€‚
  - åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ—¶ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨æ ‡è®°æœªä½¿ç”¨çš„ä»£ç æˆ–è€…ä½¿ç”¨ä¸“é—¨è®¾è®¡ç”¨äº tree shaking çš„åº“ç‰ˆæœ¬ã€‚

#### 5. Scope Hoisting ä½œç”¨åŸŸæå‡

Scope Hoisting ä¼šåˆ†æå‡ºæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå°½å¯èƒ½çš„æŠŠæ‰“åŒ…å‡ºæ¥çš„æ¨¡å—åˆå¹¶åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ã€‚

```js
jså¤åˆ¶ä»£ç const ModuleConcatenationPlugin = require('webpack/lib/ModuleConcatenationPlugin');

module.exports = {
  resolve: {
    // é’ˆå¯¹ Npm ä¸­çš„ç¬¬ä¸‰æ–¹æ¨¡å—ä¼˜å…ˆé‡‡ç”¨ jsnext:main ä¸­æŒ‡å‘ ES6 æ¨¡å—åŒ–è¯­æ³•çš„æ–‡ä»¶
    mainFields: ['jsnext:main', 'browser', 'main']
  },
  plugins: [
    // å¼€å¯ Scope Hoisting
    new ModuleConcatenationPlugin()
  ]
}
```

# ä¸‰ã€æŒç»­è·Ÿè¿›

- æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªå¾ªåºæ¸è¿›çš„è¿‡ç¨‹ï¼Œä¸åƒ bug èƒ½ä¸€æ¬¡æ€§è§£å†³ï¼›
- æŒç»­è·Ÿè¿›ç»Ÿè®¡ç»“æœï¼Œå†é€æ¸åˆ†ææ€§èƒ½ç“¶é¢ˆï¼ŒæŒç»­ä¼˜åŒ–ï¼›
- å¯ä½¿ç”¨ç¬¬ä¸‰æ–¹ç»Ÿè®¡æœåŠ¡ï¼Œå¦‚é˜¿é‡Œäº‘ ARMSã€ç™¾åº¦ç»Ÿè®¡ç­‰ç­‰ã€‚



ä½œè€…ï¼šå—æ®‡
é“¾æ¥ï¼šhttps://juejin.cn/post/7347504184068931619
æ¥æºï¼šç¨€åœŸæ˜é‡‘